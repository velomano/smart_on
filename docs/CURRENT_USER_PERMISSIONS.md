# 👥 현재 사용자 권한 설정

## 📋 개요

최고관리자가 사용자관리에서 수정한 권한이 최종 권한이 되도록 설정된 현재 상태입니다.

## 🎯 현재 권한 체계 (4단계)

### 1. **super_admin** (최고관리자)
- **계정**: `sky3rain7@gmail.com`
- **권한**: 전체 시스템 최고 관리자
- **특별 권한**: 시스템 관리자 권한 부여 가능
- **기능**: 모든 시스템 기능에 대한 완전한 접근 권한, 시스템 관리자 계정 생성/관리

### 2. **system_admin** (시스템관리자)
- **계정**: `velomano@naver.com` (현재)
- **계정**: `test0@test.com` (곧 추가 예정)
- **권한**: 시스템 전반을 관리하는 관리자
- **기능**: 농장 생성/삭제, 베드 추가/편집/삭제, 사용자 승인, 사용자 정보 편집, 팀원 정보 수정

### 3. **team_leader** (농장장)
- **1농장**: `test1@test.com`
- **2농장**: `test3@test.com`
- **3농장**: `test5@test.com`
- **권한**: 특정 농장(팀)을 관리하는 농장장
- **기능**: 자신의 농장 생성/설정, 베드 추가/편집/삭제, 팀원 정보 수정, MQTT 설정

### 4. **team_member** (팀원)
- **1농장**: `test2@test.com`
- **2농장**: `test4@test.com`
- **3농장**: `test6@test.com`
- **권한**: 농장에서 작업하는 일반 사용자
- **기능**: 자신의 농장 데이터 조회, 팀원 보기, 양액계산 사용

## 🏗️ 농장별 구성

### 1농장 팀
- **농장장**: `test1@test.com` (team_leader)
- **팀원**: `test2@test.com` (team_member)

### 2농장 팀
- **농장장**: `test3@test.com` (team_leader)
- **팀원**: `test4@test.com` (team_member)

### 3농장 팀
- **농장장**: `test5@test.com` (team_leader)
- **팀원**: `test6@test.com` (team_member)

## 🎯 권한 매트릭스

| 기능 | super_admin | system_admin | team_leader | team_member |
|------|-------------|--------------|-------------|-------------|
| **시스템 관리** | | | | |
| 시스템 관리자 권한 부여 | ✅ | ❌ | ❌ | ❌ |
| 시스템 설정 변경 | ✅ | ✅ | ❌ | ❌ |
| 전체 시스템 모니터링 | ✅ | ✅ | ❌ | ❌ |
| **농장 관리** | | | | |
| 농장 생성/삭제 | ✅ | ✅ | ❌ | ❌ |
| 모든 농장 조회 | ✅ | ✅ | ❌ | ❌ |
| 자신의 농장 조회 | ✅ | ✅ | ✅ | ✅ |
| 농장 설정 변경 | ✅ | ✅ | ✅ (자신 농장만) | ❌ |
| **베드 관리** | | | | |
| 모든 농장 베드 조회 | ✅ | ✅ | ❌ | ❌ |
| 자신의 농장 베드 조회 | ✅ | ✅ | ✅ | ✅ |
| 베드 추가/편집/삭제 | ✅ | ✅ | ✅ (자신 농장만) | ❌ |
| **사용자 관리** | | | | |
| 사용자 승인/거부 | ✅ | ✅ | ❌ | ❌ |
| 사용자 역할 변경 | ✅ | ✅ | ✅ (소속 팀원만) | ❌ |
| 팀원 활성화/비활성화 | ✅ | ✅ | ✅ (소속 팀원만) | ❌ |
| 팀원 정보 수정 | ✅ | ✅ | ✅ (소속 팀원만) | ❌ |
| **팀원 보기** | | | | |
| 모든 팀원 조회 | ✅ | ✅ | ❌ | ❌ |
| 자신의 팀원 조회 | ✅ | ✅ | ✅ | ✅ |
| **MQTT 설정** | | | | |
| 전체 MQTT 설정 | ✅ | ✅ | ❌ | ❌ |
| 농장별 MQTT 설정 | ✅ | ✅ | ✅ (자신 농장만) | ❌ |
| **데이터 조회** | | | | |
| 센서 데이터 조회 | ✅ | ✅ | ✅ (자신 농장만) | ✅ (자신 농장만) |
| 알림 조회 | ✅ | ✅ | ✅ (자신 농장만) | ✅ (자신 농장만) |
| 생육 노트 조회/작성 | ✅ | ✅ | ✅ (자신 농장만) | ✅ (자신 농장만) |
| **양액계산** | | | | |
| 양액계산 사용 | ✅ | ✅ | ✅ | ✅ |
| 양액계산 설정 | ✅ | ✅ | ✅ (자신 농장만) | ❌ |

## 🔍 권한 확인 방법

### 데이터베이스 확인
현재 권한은 다음 테이블에서 확인할 수 있습니다:

1. **`users` 테이블**: `role` 필드 (super_admin, system_admin, team_leader, team_member)
2. **`users` 테이블**: `team_id`, `team_name` 필드 (소속 농장 정보)
3. **`memberships` 테이블**: 사용자-팀 관계 (owner, operator, viewer)

### 코드에서 확인
```typescript
// apps/web-admin/src/lib/auth.ts의 getCurrentUser 함수에서
const { data: userData } = await supabase
  .from('users')
  .select('*')
  .eq('id', authUser.id)
  .single();

const { data: membershipData } = await supabase
  .from('memberships')
  .select('role, tenant_id, team_id')
  .eq('user_id', authUser.id)
  .maybeSingle();
```

## ⚠️ 중요 사항

### 권한 변경 원칙
- **최고관리자가 사용자관리에서 수정한 권한이 최종 권한**
- 문서나 코드에서 임의로 권한을 변경하지 않음
- 모든 권한 변경은 관리자 페이지를 통해서만 수행

### 권한 일관성
- `users.role`과 `memberships.role`이 일치해야 함
- `users.team_id`와 `memberships.team_id`가 일치해야 함
- 권한 변경 시 두 테이블 모두 업데이트 필요

## 📝 업데이트 이력

- **2025.09.28**: 현재 실제 권한 설정에 맞게 문서 정리
- **기준**: 최고관리자(sky3rain7@gmail.com)가 사용자관리에서 설정한 권한
- **시스템관리자**: velomano@naver.com (곧 test0@test.com 추가 예정)

---

**문서 작성일**: 2025.09.28  
**작성자**: 스마트팜 개발팀  
**버전**: 1.0 (현재 실제 권한 반영)
